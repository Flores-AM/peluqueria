{"version":3,"sources":["firebaseConfig.js","global.js","firestore.js","admin.js","email.js","app.js"],"names":["firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","window","brevoConfig","senderEmail","senderName","adminEmail","firebase","apps","length","initializeApp","firebaseAuth","auth","db","firestore","googleProvider","GoogleAuthProvider","addScope","Error","firestoreDB","obtenerConfiguracion","doc","collection","get","exists","data","horarioApertura","replace","horarioCierre","Array","isArray","diasLaborales","JSON","parse","e","console","error","split","map","Number","filter","n","isNaN","diasNoLaborables","Boolean","async","fecha","where","docs","generarHorariosDisponibles","config","turnosOcupados","Promise","all","this","obtenerTurnosPorFecha","horariosOcupados","t","horario","_generarHorarios","fechaSeleccionada","horaApertura","parseInt","minApertura","horaCierre","minCierre","duracion","duracionTurno","horarios","horaActual","minActual","horarioStr","toString","padStart","push","hora","disponible","includes","Math","floor","verificarDisponibilidad","limit","empty","code","some","obtenerTurnosSolapados","horaStr","minutoStr","horaInicio","minutoFin","minutoFinAjustado","horarioFin","userId","add","timestamp","FieldValue","serverTimestamp","expiresAt","Date","now","id","eliminarBloqueoTemporal","bloqueoId","delete","guardarTurno","turnoData","estado","createdAt","actualizadoEl","ADMIN_UID","elements","authContainer","document","getElementById","adminPanel","loginBtn","logoutBtn","calendar","turnosList","fechaTitulo","modalEditar","formEditar","btnEliminar","querySelector","btnEliminarModal","closeModal","currentTurnoId","verificarFirestore","alert","setTimeout","location","reload","initAdmin","onAuthStateChanged","handleAuthState","addEventListener","signInWithGoogle","signOut","style","display","preventDefault","guardarCambiosTurno","onclick","target","obtenerConfiguracionPorDefecto","dias","warn","startsWith","normalizarDias","sort","a","b","validarHorario","horas","minutos","horarioEnMinutos","aperturaH","aperturaM","cierreH","cierreM","valido","mensaje","user","uid","showAdminPanel","initCalendar","loadTurnosForDate","toISOString","showLoginScreen","destroy","provider","signInWithPopup","message","FullCalendar","Calendar","initialView","locale","headerToolbar","left","center","right","selectable","selectMirror","dayMaxEvents","selectOverlap","dateClick","info","querySelectorAll","forEach","el","classList","remove","dayEl","dateStr","events","fetchInfo","successCallback","failureCallback","snapshot","startStr","endStr","title","cliente","servicios","join","start","allDay","extendedProps","telefono","email","observaciones","className","borderColor","eventClick","abrirModalEdicion","event","select","unselect","dayMaxEventRows","views","dayGridMonth","displayEventTime","timeGridWeek","timeGridDay","viewDidMount","render","getEventColor","date","fechaObj","fechaAjustada","getTime","getTimezoneOffset","options","weekday","year","month","day","textContent","toLocaleDateString","renderTurnos","orderBy","innerHTML","turnos","turno","header","tagName","card","closest","detalles","icon","toggle","contains","btn","stopPropagation","turnoId","currentTarget","getAttribute","confirm","loading","mostrarLoading","eliminarTurno","fechaActual","abrirModalEdicionPorId","generarOpcionesHorario","value","getHours","getMinutes","refetchEvents","configurarModalEliminar","loadingIndicator","createElement","body","appendChild","selectHorario","minutoActual","option","minuto","inicioEnMinutos","finEnMinutos","query","turnosSolapados","turnoHora","turnoMinuto","turnoInicio","turnoFin","currentUser","fechaInput","log","validacionHorario","diaSemana","getDay","disponibilidad","turnoActualizado","update","fechaTurno","setupModalEvents","modal","enviarEmailConfirmacion","datosTurno","emailData","to","name","nombre","subject","htmlContent","s","reserva","toLocaleString","montoTotal","getFullYear","bcc","enviarEmail","functions","httpsCallable","success","pasoActual","totalPasos","datosReserva","precios","Corte","Alisado","observacion","usuarioActual","elementos","progreso","btnAnterior","btnSiguiente","pasos","resumenNombre","resumenEmail","resumenTelefono","resumenServicio","resumenFecha","resumenHorario","resumenObservacion","probarConexion","hoy","mostrarError","errorContainer","inicializarEventos","retrocederPaso","avanzarPaso","servicio","actualizarServiciosSeleccionados","seleccionarElemento","horarioSeleccionado","validacion","validarDisponibilidadCompleta","validarNombre","validarEmail","validarTelefono","calcularSubtotal","subtotal","reduce","total","precio","serviciosSeleccionados","from","serv","validarPaso","actualizarInterfaz","autocompletarFormulario","guardarDatosFormulario","actualizarResumen","actualizarPasos","actualizarProgreso","actualizarBotones","simularReserva","loader","duracionTotal","requestAnimationFrame","mostrarConfirmacion","then","enviado","completarReserva","bloquearTurnoTemporal","catch","inicializarDisponibilidad","actualizarUIFechas","generarFechasDisponibles","ahoraArg","timeZone","hoyArg","getMonth","getDate","empezarDesdeManana","fechasDisponibles","diaInicial","i","setDate","esDiaLaboral","fechaStr","formatearFechaDisplay","obtenerFechaSeleccionada","partes","dia","mes","paso2","contenedorFechas","plantillaFecha","cargando","sinFechas","nuevoElemento","cloneNode","dataset","fechaReal","cargarHorariosParaFecha","paso3","contenedor","sinHorarios","ahoraEnMinutos","tiempoMinimoReserva","actualizarUIHorarios","horariosDisponibles","elemento","p1","svg","createElementNS","setAttribute","path","verificarDisponibilidadEnTiempoReal","trim","removeEventListener","manejarClickHorario","crearContenedorHorarios","paso","index","porcentaje","width","replaceWith","tipo","pasoElement","errores","msg","errorServicio","animation","errorFecha","errorHorario","validarFormulario","test","emailElement","listaServicios","saldoPendiente","max","input","errorMsg","exito","paso6","botonNuevaReserva","insertAdjacentHTML","inicializarAuth","btnGoogle","outerHTML","displayName","guardarUsuario","limpiarUsuario","mostrarErrorAuth","localStorage","setItem","stringify","removeItem","actualizarUIUsuario","mostrarBotonLogin","parentElement","paso4","nombreInput","emailInput","usuarioLS","getItem"],"mappings":"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","file":"bundle.min.js","sourcesContent":["// firebaseConfig.js - Versión completa\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyBFYeM1-ZmdTwKUS4hLjx4pyBcryxdyTYU\",\r\n  authDomain: \"peluqueria-2d648.firebaseapp.com\",\r\n  projectId: \"peluqueria-2d648\",\r\n  storageBucket: \"peluqueria-2d648.appspot.com\",\r\n  messagingSenderId: \"115281106854\",\r\n  appId: \"1:115281106854:web:309315fc966472f4892167\"\r\n};\r\n\r\n// Configuración Brevo\r\nwindow.brevoConfig = {\r\n  senderEmail: \"agustinmatiasf@gmail.com\",\r\n  senderName: \"Esvelta Peluquería\",\r\n  adminEmail: \"agustinmatias62@gmail.com\"\r\n};\r\n\r\n// Inicializar Firebase\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\n// Exportar las instancias necesarias\r\nwindow.firebaseAuth = firebase.auth();\r\nwindow.db = firebase.firestore();","window.googleProvider = new firebase.auth.GoogleAuthProvider();\r\nwindow.googleProvider.addScope('profile');\r\nwindow.googleProvider.addScope('email');","// firestore.js - Versión completa con validación cruzada\r\n(() => {\r\n  if (!firebase.apps.length) {\r\n    throw new Error('Firebase no está inicializado');\r\n  }\r\n\r\n  const { db } = window;\r\n\r\n  window.firestoreDB = {\r\n    // Obtener configuración\r\n    async obtenerConfiguracion() {\r\n      const doc = await db.collection('config').doc('horarios').get();\r\n      if (!doc.exists) throw new Error(\"No se encontró configuración\");\r\n      \r\n      const data = doc.data();\r\n      \r\n      // Limpiar formatos de horarios\r\n      if (typeof data.horarioApertura === 'string') {\r\n        data.horarioApertura = data.horarioApertura.replace(/\"/g, '');\r\n      }\r\n      if (typeof data.horarioCierre === 'string') {\r\n        data.horarioCierre = data.horarioCierre.replace(/\"/g, '');\r\n      }\r\n      \r\n      // Convertir diasLaborales a array de números\r\n      if (Array.isArray(data.diasLaborales)) {\r\n        if (data.diasLaborales.length === 1 && typeof data.diasLaborales[0] === 'string') {\r\n          // Caso: ['[1,2,3,4,5]']\r\n          try {\r\n            data.diasLaborales = JSON.parse(data.diasLaborales[0]);\r\n          } catch (e) {\r\n            console.error(\"Error parseando diasLaborales:\", e);\r\n            data.diasLaborales = [1,2,3,4,5]; // Valor por defecto (L-V)\r\n          }\r\n        }\r\n      } else if (typeof data.diasLaborales === 'string') {\r\n        // Caso: \"1,2,3,4,5\"\r\n        data.diasLaborales = data.diasLaborales.split(',').map(Number).filter(n => !isNaN(n));\r\n      }\r\n      \r\n      // Convertir diasNoLaborables si es necesario\r\n      if (typeof data.diasNoLaborables === 'string') {\r\n        try {\r\n          data.diasNoLaborables = JSON.parse(data.diasNoLaborables);\r\n        } catch (e) {\r\n          data.diasNoLaborables = data.diasNoLaborables.replace(/[\\[\\]\\s]/g, '').split(',').filter(Boolean);\r\n        }\r\n      }\r\n      \r\n      return data;\r\n    },\r\n\r\n    // Obtener turnos por fecha\r\n    async obtenerTurnosPorFecha(fecha) {\r\n      const snapshot = await db.collection('turnos')\r\n        .where('fecha', '==', fecha)\r\n        .get();\r\n      return snapshot.docs.map(doc => doc.data());\r\n    },\r\n\r\n    // Generar horarios disponibles\r\n    async generarHorariosDisponibles(fecha) {\r\n      const [config, turnosOcupados] = await Promise.all([\r\n        this.obtenerConfiguracion(),\r\n        this.obtenerTurnosPorFecha(fecha)\r\n      ]);\r\n      \r\n      const horariosOcupados = turnosOcupados.map(t => t.horario);\r\n      return this._generarHorarios(config, horariosOcupados, fecha);\r\n      // Devuelve el array completo de objetos {hora, disponible} sin mapear solo las horas\r\n    },\r\n\r\n    // Función privada para generar horarios\r\n    _generarHorarios(config, horariosOcupados, fechaSeleccionada) {\r\n      const horarioApertura = config.horarioApertura;\r\n      const horarioCierre = config.horarioCierre;\r\n      \r\n      // Asegurar formato correcto (por si hay puntos en lugar de dos puntos)\r\n      const horaApertura = parseInt(horarioApertura.replace('.', ':').split(':')[0]);\r\n      const minApertura = parseInt(horarioApertura.replace('.', ':').split(':')[1] || 0);\r\n      const horaCierre = parseInt(horarioCierre.replace('.', ':').split(':')[0]);\r\n      const minCierre = parseInt(horarioCierre.replace('.', ':').split(':')[1] || 0);\r\n      const duracion = config.duracionTurno;\r\n\r\n      // Validación de valores numéricos\r\n      if (isNaN(horaApertura)) throw new Error('Horario apertura inválido');\r\n      if (isNaN(minApertura)) minApertura = 0;\r\n      if (isNaN(horaCierre)) throw new Error('Horario cierre inválido');\r\n      if (isNaN(minCierre)) minCierre = 0;\r\n      if (isNaN(duracion)) throw new Error('Duración turno inválida');\r\n\r\n      const horarios = [];\r\n      let horaActual = horaApertura;\r\n      let minActual = minApertura;\r\n\r\n      while (horaActual < horaCierre || (horaActual === horaCierre && minActual <= minCierre)) {\r\n        const horarioStr = `${horaActual.toString().padStart(2, '0')}:${minActual.toString().padStart(2, '0')}`;\r\n        \r\n        horarios.push({\r\n          hora: horarioStr,\r\n          disponible: !horariosOcupados.includes(horarioStr)\r\n        });\r\n\r\n        // Avanzar el tiempo\r\n        minActual += duracion;\r\n        if (minActual >= 60) {\r\n          horaActual += Math.floor(minActual / 60);\r\n          minActual = minActual % 60;\r\n        }\r\n      }\r\n\r\n      // Validación mínima de resultados\r\n      if (horarios.length === 0) {\r\n        console.error('No se generaron horarios con la configuración:', config);\r\n        throw new Error('No se pudieron generar horarios');\r\n      }\r\n\r\n      return horarios;\r\n    },\r\n\r\n    // Verificar disponibilidad básica\r\n    async verificarDisponibilidad(fecha, horario) {\r\n      try {\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .where('horario', '==', horario)\r\n          .limit(1)\r\n          .get();\r\n          \r\n        return snapshot.empty;\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        \r\n        // Fallback: verificar solo por fecha si falla la consulta compuesta\r\n        if (error.code === 'failed-precondition') {\r\n          const snapshot = await db.collection('turnos')\r\n            .where('fecha', '==', fecha)\r\n            .get();\r\n            \r\n          const ocupado = snapshot.docs.some(doc => doc.data().horario === horario);\r\n          return !ocupado;\r\n        }\r\n        \r\n        throw error; // Relanzar otros errores\r\n      }\r\n    },\r\n\r\n    // Verificar solapamientos\r\n    async obtenerTurnosSolapados(fecha, horario, duracion) {\r\n      const [horaStr, minutoStr] = horario.split(':');\r\n      const horaInicio = parseInt(horaStr);\r\n      const minutoInicio = parseInt(minutoStr);\r\n      \r\n      const minutoFin = minutoInicio + duracion;\r\n      const horaFin = horaInicio + Math.floor(minutoFin / 60);\r\n      const minutoFinAjustado = minutoFin % 60;\r\n      const horarioFin = `${horaFin.toString().padStart(2, '0')}:${minutoFinAjustado.toString().padStart(2, '0')}`;\r\n      \r\n      const snapshot = await db.collection('turnos')\r\n        .where('fecha', '==', fecha)\r\n        .where('horario', '>=', horario)\r\n        .where('horario', '<', horarioFin)\r\n        .get();\r\n        \r\n      return snapshot.docs.map(doc => doc.data());\r\n    },\r\n\r\n    // Bloqueo temporal\r\n    async bloquearTurnoTemporal(fecha, horario, userId) {\r\n      const docRef = await db.collection('bloqueos_temporales').add({\r\n        fecha,\r\n        horario,\r\n        userId,\r\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n        expiresAt: new Date(Date.now() + 5*60*1000) // 5 minutos de expiración\r\n      });\r\n      return docRef.id; // Devolver el ID automático\r\n    },\r\n\r\n    async eliminarBloqueoTemporal(bloqueoId) {\r\n      await db.collection('bloqueos_temporales').doc(bloqueoId).delete();\r\n    },\r\n\r\n    // Guardar turno\r\n    async guardarTurno(turnoData) {\r\n      try {\r\n        const docRef = await db.collection('turnos').add({\r\n          ...turnoData,\r\n          estado: 'pendiente', // Asegurar estado inicial\r\n          createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n          actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n        });\r\n        \r\n        return { id: docRef.id, ...turnoData };\r\n      } catch (error) {\r\n        console.error(\"Error guardando turno:\", error);\r\n        throw error; // Relanzar para manejo superior\r\n      }\r\n    }\r\n  };\r\n})();","const ADMIN_UID = 'lnYDaOVZYOZLi9GyDdomUOZBf5p1';\r\n\r\n// Elementos del DOM\r\nconst elements = {\r\n  authContainer: document.getElementById('auth-container'),\r\n  adminPanel: document.getElementById('admin-panel'),\r\n  loginBtn: document.getElementById('btn-admin-login'),\r\n  logoutBtn: document.getElementById('logout-btn'),\r\n  calendar: document.getElementById('calendar'),\r\n  turnosList: document.getElementById('turnos-list'),\r\n  fechaTitulo: document.getElementById('fecha-titulo'),\r\n  modalEditar: document.getElementById('modal-editar'),\r\n  formEditar: document.getElementById('form-editar'),\r\n  btnEliminar: document.querySelector('.btn-eliminar'),\r\n  btnEliminarModal: document.getElementById('btn-eliminar-modal'),\r\n  closeModal: document.querySelector('.close-modal')\r\n};\r\n\r\nlet calendar;\r\nlet currentTurnoId = null;\r\n\r\nasync function verificarFirestore() {\r\n  try {\r\n    const config = await obtenerConfiguracion();\r\n    // console.log(\"Configuración cargada correctamente:\", config);\r\n    return true;\r\n  } catch (error) {\r\n    console.error(\"Error conectando con Firestore:\", error);\r\n    alert(\"Error al conectar con la base de datos. Recargando...\");\r\n    setTimeout(() => location.reload(), 3000);\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function initAdmin() {\r\n\r\n  if (!(await verificarFirestore())) return;\r\n  \r\n  if (!elements.authContainer) return;\r\n\r\n  firebase.auth().onAuthStateChanged(handleAuthState);\r\n  \r\n  if (elements.loginBtn) {\r\n    elements.loginBtn.addEventListener('click', signInWithGoogle);\r\n  }\r\n  \r\n  if (elements.logoutBtn) {\r\n    elements.logoutBtn.addEventListener('click', signOut);\r\n  }\r\n\r\n  // Eventos del modal\r\n  if (elements.closeModal) {\r\n    elements.closeModal.addEventListener('click', () => {\r\n      elements.modalEditar.style.display = 'none';\r\n    });\r\n  }\r\n\r\n  if (elements.formEditar) {\r\n    elements.formEditar.addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n      await guardarCambiosTurno();\r\n    });\r\n  }\r\n\r\n  // Eliminar cualquier listener previo del botón eliminar\r\n  const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n  if (btnEliminarModal) {\r\n    btnEliminarModal.onclick = null;\r\n  }\r\n\r\n  // Cerrar modal al hacer click fuera\r\n  window.addEventListener('click', (e) => {\r\n    if (e.target === elements.modalEditar) {\r\n      elements.modalEditar.style.display = 'none';\r\n    }\r\n  });\r\n}\r\n\r\n// Agregar estas funciones al inicio del admin.js\r\nasync function obtenerConfiguracion() {\r\n  try {\r\n    const doc = await db.collection('config').doc('horarios').get();\r\n    if (!doc.exists) return obtenerConfiguracionPorDefecto();\r\n    \r\n    const data = doc.data();\r\n    \r\n    // Función robusta para normalizar días laborales\r\n    const normalizarDias = (dias) => {\r\n      if (!dias) return [1,2,3,4,5];\r\n      \r\n      // Caso: array con string JSON ['[1,2,3,4,5]']\r\n      if (Array.isArray(dias) && dias.length === 1 && typeof dias[0] === 'string') {\r\n        try {\r\n          return JSON.parse(dias[0].replace(/'/g, '\"')).map(Number);\r\n        } catch (e) {\r\n          console.warn(\"Error parseando array con string JSON\", e);\r\n        }\r\n      }\r\n      \r\n      // Caso: string \"[1,2,3,4,5]\"\r\n      if (typeof dias === 'string' && dias.startsWith('[')) {\r\n        try {\r\n          return JSON.parse(dias.replace(/'/g, '\"')).map(Number);\r\n        } catch (e) {\r\n          console.warn(\"Error parseando string JSON\", e);\r\n        }\r\n      }\r\n      \r\n      // Caso: array de números [1,2,3,4,5]\r\n      if (Array.isArray(dias)) return dias.map(Number);\r\n      \r\n      // Caso: string simple \"1,2,3,4,5\"\r\n      if (typeof dias === 'string') {\r\n        return dias.split(',').map(Number).filter(n => !isNaN(n));\r\n      }\r\n      \r\n      return [1,2,3,4,5]; // Default\r\n    };\r\n    \r\n    const diasLaborales = normalizarDias(data.diasLaborales)\r\n      .filter(n => n >= 0 && n <= 6) // Filtrar valores inválidos\r\n      .sort((a, b) => a - b); // Ordenar\r\n    \r\n    return {\r\n      horarioApertura: data.horarioApertura || \"09:00\",\r\n      horarioCierre: data.horarioCierre || \"19:00\",\r\n      duracionTurno: data.duracionTurno || 30,\r\n      diasLaborales: diasLaborales.length > 0 ? diasLaborales : [1,2,3,4,5]\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error obteniendo configuración:\", error);\r\n    return obtenerConfiguracionPorDefecto();\r\n  }\r\n}\r\n\r\nfunction obtenerConfiguracionPorDefecto() {\r\n  return {\r\n    horarioApertura: \"09:00\",\r\n    horarioCierre: \"19:00\",\r\n    duracionTurno: 30,\r\n    diasLaborales: [1,2,3,4,5] // Lunes a Viernes\r\n  };\r\n}\r\n\r\nfunction validarHorario(horario, config) {\r\n  // Convertir horario a minutos desde medianoche\r\n  const [horas, minutos] = horario.split(':').map(Number);\r\n  const horarioEnMinutos = horas * 60 + minutos;\r\n  \r\n  // Convertir horarios de apertura/cierre\r\n  const [aperturaH, aperturaM] = config.horarioApertura.split(':').map(Number);\r\n  const [cierreH, cierreM] = config.horarioCierre.split(':').map(Number);\r\n  const aperturaEnMinutos = aperturaH * 60 + aperturaM;\r\n  const cierreEnMinutos = cierreH * 60 + cierreM;\r\n  \r\n  // Validar que esté dentro del horario laboral\r\n  if (horarioEnMinutos < aperturaEnMinutos || horarioEnMinutos >= cierreEnMinutos) {\r\n    return {\r\n      valido: false,\r\n      mensaje: `El horario debe estar entre ${config.horarioApertura} y ${config.horarioCierre}`\r\n    };\r\n  }\r\n  \r\n  // Validar que sea en intervalos de 30 minutos\r\n  if (minutos % config.duracionTurno !== 0) {\r\n    return {\r\n      valido: false,\r\n      mensaje: `Los turnos deben ser en intervalos de ${config.duracionTurno} minutos (ej: 09:00, 09:30, etc.)`\r\n    };\r\n  }\r\n  \r\n  return { valido: true };\r\n}\r\n\r\nasync function handleAuthState(user) {\r\n  if (user && user.uid === ADMIN_UID) {\r\n    await showAdminPanel();\r\n    await initCalendar();\r\n    await loadTurnosForDate(new Date().toISOString().split('T')[0]);\r\n  } else {\r\n    showLoginScreen();\r\n  }\r\n}\r\n\r\nasync function showAdminPanel() {\r\n  if (elements.authContainer) elements.authContainer.style.display = 'none';\r\n  if (elements.adminPanel) elements.adminPanel.style.display = 'block';\r\n}\r\n\r\nfunction showLoginScreen() {\r\n  if (elements.authContainer) elements.authContainer.style.display = 'flex';\r\n  if (elements.adminPanel) elements.adminPanel.style.display = 'none';\r\n  if (calendar) calendar.destroy();\r\n}\r\n\r\nasync function signInWithGoogle() {\r\n  try {\r\n    const provider = new firebase.auth.GoogleAuthProvider();\r\n    await firebase.auth().signInWithPopup(provider);\r\n  } catch (error) {\r\n    console.error(\"Error de autenticación:\", error);\r\n    alert(\"Error al iniciar sesión: \" + error.message);\r\n  }\r\n}\r\n\r\nasync function signOut() {\r\n  try {\r\n    await firebase.auth().signOut();\r\n  } catch (error) {\r\n    console.error(\"Error al cerrar sesión:\", error);\r\n  }\r\n}\r\n\r\nasync function initCalendar() {\r\n  if (!elements.calendar) return;\r\n  \r\n  calendar = new FullCalendar.Calendar(elements.calendar, {\r\n    initialView: 'dayGridMonth',\r\n    locale: 'es',\r\n    headerToolbar: {\r\n      left: 'prev,next today',\r\n      center: 'title',\r\n      right: 'none'\r\n    },\r\n    selectable: true,\r\n    selectMirror: true,\r\n    dayMaxEvents: true,\r\n    selectOverlap: false,\r\n    \r\n    dateClick: async function(info) {\r\n      // Remover la clase de selección de todas las celdas primero\r\n      document.querySelectorAll('.fc-daygrid-day-selected').forEach(el => {\r\n        el.classList.remove('fc-daygrid-day-selected');\r\n      });\r\n      \r\n      // Añadir la clase de selección a la celda clickeada\r\n      info.dayEl.classList.add('fc-daygrid-day-selected');\r\n      \r\n      // Cargar los turnos para la fecha seleccionada\r\n      await loadTurnosForDate(info.dateStr);\r\n    },\r\n    \r\n    events: async function(fetchInfo, successCallback, failureCallback) {\r\n      try {\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '>=', fetchInfo.startStr)\r\n          .where('fecha', '<=', fetchInfo.endStr)\r\n          .get();\r\n        \r\n        const events = snapshot.docs.map(doc => {\r\n          const data = doc.data();\r\n          return {\r\n            id: doc.id,\r\n            title: `${data.cliente} - ${data.servicios.join(', ')}`,\r\n            start: `${data.fecha}T${data.horario}`,\r\n            allDay: false,\r\n            extendedProps: {\r\n              cliente: data.cliente,\r\n              telefono: data.telefono,\r\n              email: data.email,\r\n              servicios: data.servicios,\r\n              observaciones: data.observaciones,\r\n              estado: data.estado || 'pendiente'\r\n            },\r\n            className: `fc-event-${data.estado || 'pendiente'}`,\r\n            borderColor: 'transparent'\r\n          };\r\n        });\r\n        \r\n        successCallback(events);\r\n      } catch (error) {\r\n        console.error(\"Error cargando eventos:\", error);\r\n        failureCallback(error);\r\n      }\r\n    },\r\n    \r\n    eventClick: function(info) {\r\n      abrirModalEdicion(info.event);\r\n    },\r\n    \r\n    select: function(info) {\r\n      calendar.unselect();\r\n    },\r\n    \r\n    dayMaxEventRows: false,\r\n    views: {\r\n      dayGridMonth: {\r\n        dayMaxEventRows: false,\r\n        displayEventTime: false\r\n      },\r\n      timeGridWeek: {\r\n        dayMaxEventRows: true\r\n      },\r\n      timeGridDay: {\r\n        dayMaxEventRows: true\r\n      }\r\n    },\r\n    \r\n    // Limpiar selección al cambiar de vista\r\n    viewDidMount: function() {\r\n      document.querySelectorAll('.fc-daygrid-day-selected').forEach(el => {\r\n        el.classList.remove('fc-daygrid-day-selected');\r\n      });\r\n    }\r\n  });\r\n  \r\n  calendar.render();\r\n}\r\n\r\nfunction getEventColor(estado) {\r\n  switch(estado) {\r\n    case 'confirmado': return '#4CAF50';\r\n    case 'cancelado': return '#F44336';\r\n    case 'completado': return '#2196F3';\r\n    default: return '#FF9800';\r\n  }\r\n}\r\n\r\nasync function loadTurnosForDate(date) {\r\n  try {\r\n    // Corregir formato de fecha para el título\r\n    const fechaObj = new Date(date);\r\n    // Ajustar por zona horaria\r\n    const fechaAjustada = new Date(fechaObj.getTime() + fechaObj.getTimezoneOffset() * 60000);\r\n    \r\n    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\r\n    elements.fechaTitulo.textContent = `Turnos para ${fechaAjustada.toLocaleDateString('es-AR', options)}`;\r\n    \r\n    const snapshot = await db.collection('turnos')\r\n      .where('fecha', '==', date)\r\n      .orderBy('horario', 'asc')\r\n      .get();\r\n    \r\n    renderTurnos(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n  } catch (error) {\r\n    console.error(\"Error cargando turnos:\", error);\r\n    elements.turnosList.innerHTML = '<p>Error al cargar los turnos. Intente nuevamente.</p>';\r\n  }\r\n}\r\n\r\nfunction renderTurnos(turnos) {\r\n  if (!elements.turnosList) return;\r\n  \r\n  if (turnos.length === 0) {\r\n    elements.turnosList.innerHTML = '<p class=\"sin-turnos\">No hay turnos para esta fecha.</p>';\r\n    return;\r\n  }\r\n  \r\n  elements.turnosList.innerHTML = turnos.map(turno => `\r\n    <div class=\"turno-card\" data-id=\"${turno.id}\">\r\n      <div class=\"turno-header\" data-id=\"${turno.id}\">\r\n        <div class=\"turno-sumario\">\r\n          <span class=\"turno-horario\">${turno.horario}</span>\r\n          <span class=\"turno-cliente\">${turno.cliente}</span>\r\n          <span class=\"turno-estado ${turno.estado || 'pendiente'}\">${turno.estado || 'pendiente'}</span>\r\n        </div>\r\n        <span class=\"toggle-icon\">▼</span>\r\n      </div>\r\n      <div class=\"turno-detalles\">\r\n        <div class=\"turno-info\">\r\n          <p><strong>Servicios:</strong> ${turno.servicios.join(', ')}</p>\r\n          <p><strong>Teléfono:</strong> ${turno.telefono}</p>\r\n          <p><strong>Email:</strong> ${turno.email}</p>\r\n          ${turno.observaciones ? `<p><strong>Observaciones:</strong> ${turno.observaciones}</p>` : ''}\r\n        </div>\r\n        <div class=\"turno-actions\">\r\n          <button class=\"btn-editar\" data-id=\"${turno.id}\">Editar</button>\r\n          <button class=\"btn-eliminar-lista\" data-id=\"${turno.id}\">Eliminar</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n  \r\n  // Configurar eventos para expandir/colapsar\r\n  document.querySelectorAll('.turno-header').forEach(header => {\r\n    header.addEventListener('click', function(e) {\r\n      // Evitar que se active si se hace click en un botón de acción\r\n      if (e.target.tagName === 'BUTTON') return;\r\n      \r\n      const card = this.closest('.turno-card');\r\n      const detalles = card.querySelector('.turno-detalles');\r\n      const icon = this.querySelector('.toggle-icon');\r\n      \r\n      card.classList.toggle('expanded');\r\n      detalles.style.display = card.classList.contains('expanded') ? 'block' : 'none';\r\n      icon.textContent = card.classList.contains('expanded') ? '▲' : '▼';\r\n    });\r\n  });\r\n  \r\n  // Configurar eventos para los botones eliminar (existente)\r\n  document.querySelectorAll('.btn-eliminar-lista').forEach(btn => {\r\n    btn.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      const turnoId = e.currentTarget.getAttribute('data-id');\r\n      \r\n      if (confirm('¿Estás seguro de eliminar este turno?')) {\r\n        const loading = mostrarLoading();\r\n        try {\r\n          await eliminarTurno(turnoId);\r\n          const fechaActual = new Date().toISOString().split('T')[0];\r\n          await loadTurnosForDate(fechaActual);\r\n        } catch (error) {\r\n          console.error(\"Error eliminando desde lista:\", error);\r\n          alert(\"Error al eliminar el turno\");\r\n        } finally {\r\n          loading.remove();\r\n        }\r\n      }\r\n    });\r\n  });\r\n  \r\n  // Configurar eventos para los botones editar (existente)\r\n  document.querySelectorAll('.btn-editar').forEach(btn => {\r\n    btn.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      const turnoId = e.currentTarget.getAttribute('data-id');\r\n      await abrirModalEdicionPorId(turnoId);\r\n    });\r\n  });\r\n}\r\n\r\nasync function abrirModalEdicion(event) {\r\n  try {\r\n    const config = await obtenerConfiguracion();\r\n    await generarOpcionesHorario(config);\r\n    \r\n    currentTurnoId = event.id;\r\n    \r\n    // Llenar solo los campos necesarios\r\n    document.getElementById('turno-id').value = event.id;\r\n    document.getElementById('edit-fecha').value = event.start.toISOString().split('T')[0];\r\n    \r\n    // Formatear hora (HH:MM)\r\n    const hora = event.start.getHours().toString().padStart(2, '0');\r\n    const minutos = event.start.getMinutes().toString().padStart(2, '0');\r\n    document.getElementById('edit-horario').value = `${hora}:${minutos}`;\r\n    \r\n    // Mostrar información del turno en el modal\r\n    document.getElementById('turno-info').innerHTML = `\r\n      <p><strong>Cliente:</strong> ${event.extendedProps.cliente}</p>\r\n      <p><strong>Servicios:</strong> ${event.extendedProps.servicios.join(', ')}</p>\r\n      <p><strong>Teléfono:</strong> ${event.extendedProps.telefono}</p>\r\n      <p><strong>Estado:</strong> ${event.extendedProps.estado || 'pendiente'}</p>\r\n    `;\r\n    \r\n    elements.modalEditar.style.display = 'block';\r\n  } catch (error) {\r\n    console.error(\"Error abriendo modal de edición:\", error);\r\n    alert(\"Error al cargar los datos del turno\");\r\n  }\r\n}\r\n\r\nasync function abrirModalEdicionPorId(turnoId) {\r\n  try {\r\n    const config = await obtenerConfiguracion();\r\n    await generarOpcionesHorario(config);\r\n    \r\n    const doc = await db.collection('turnos').doc(turnoId).get();\r\n    if (!doc.exists) {\r\n      alert('Turno no encontrado');\r\n      return;\r\n    }\r\n    \r\n    const turno = doc.data();\r\n    currentTurnoId = turnoId;\r\n    \r\n    // Llenar solo los campos necesarios para el formulario simplificado\r\n    document.getElementById('turno-id').value = turnoId;\r\n    document.getElementById('edit-fecha').value = turno.fecha;\r\n    document.getElementById('edit-horario').value = turno.horario;\r\n    \r\n    // Mostrar información del turno en el modal\r\n    document.getElementById('turno-info').innerHTML = `\r\n      <p><strong>Cliente:</strong> ${turno.cliente}</p>\r\n      <p><strong>Servicios:</strong> ${Array.isArray(turno.servicios) ? turno.servicios.join(', ') : turno.servicios}</p>\r\n      <p><strong>Teléfono:</strong> ${turno.telefono}</p>\r\n      <p><strong>Estado:</strong> ${turno.estado || 'pendiente'}</p>\r\n    `;\r\n    \r\n    // Configurar el botón eliminar del modal\r\n    const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n    if (btnEliminarModal) {\r\n      btnEliminarModal.onclick = async (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        \r\n        if (confirm('¿Estás seguro de eliminar este turno permanentemente?')) {\r\n          try {\r\n            const success = await eliminarTurno(currentTurnoId);\r\n            if (success) {\r\n              // Actualizar la vista\r\n              await loadTurnosForDate(turno.fecha);\r\n              calendar.refetchEvents();\r\n              elements.modalEditar.style.display = 'none';\r\n              alert('Turno eliminado correctamente');\r\n            }\r\n          } catch (error) {\r\n            console.error(\"Error al eliminar turno:\", error);\r\n            alert(\"Error al eliminar el turno: \" + error.message);\r\n          }\r\n        }\r\n      };\r\n    }\r\n    \r\n    elements.modalEditar.style.display = 'block';\r\n  } catch (error) {\r\n    console.error(\"Error abriendo modal de edición:\", error);\r\n    alert(\"Error al cargar los datos del turno\");\r\n  }\r\n}\r\n\r\nfunction configurarModalEliminar() {\r\n  const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n  if (!btnEliminarModal) return;\r\n\r\n  // Limpiar eventos previos\r\n  btnEliminarModal.onclick = null;\r\n  \r\n  // Asignar nuevo evento\r\n  btnEliminarModal.onclick = async (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    if (!currentTurnoId) {\r\n      console.error('No hay turno seleccionado');\r\n      return;\r\n    }\r\n\r\n    if (confirm('¿Estás seguro de eliminar este turno permanentemente?')) {\r\n      const loadingIndicator = mostrarLoading();\r\n      try {\r\n        await eliminarTurno(currentTurnoId);\r\n      } catch (error) {\r\n        console.error(\"Error en eliminación:\", error);\r\n      } finally {\r\n        loadingIndicator.remove();\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nfunction mostrarLoading() {\r\n  const loading = document.createElement('div');\r\n  loading.className = 'loading-indicator';\r\n  loading.textContent = 'Procesando...';\r\n  document.body.appendChild(loading);\r\n  return loading;\r\n}\r\n\r\nasync function generarOpcionesHorario(config) {\r\n  const selectHorario = document.getElementById('edit-horario');\r\n  selectHorario.innerHTML = '';\r\n  \r\n  // Convertir horarios de apertura/cierre a minutos\r\n  const [aperturaH, aperturaM] = config.horarioApertura.split(':').map(Number);\r\n  const [cierreH, cierreM] = config.horarioCierre.split(':').map(Number);\r\n  \r\n  let horaActual = aperturaH;\r\n  let minutoActual = aperturaM;\r\n  \r\n  while (horaActual < cierreH || (horaActual === cierreH && minutoActual < cierreM)) {\r\n    const horaStr = horaActual.toString().padStart(2, '0');\r\n    const minutoStr = minutoActual.toString().padStart(2, '0');\r\n    const option = document.createElement('option');\r\n    option.value = `${horaStr}:${minutoStr}`;\r\n    option.textContent = `${horaStr}:${minutoStr}`;\r\n    selectHorario.appendChild(option);\r\n    \r\n    // Avanzar el tiempo\r\n    minutoActual += config.duracionTurno;\r\n    if (minutoActual >= 60) {\r\n      horaActual += Math.floor(minutoActual / 60);\r\n      minutoActual = minutoActual % 60;\r\n    }\r\n  }\r\n}\r\n\r\nasync function verificarDisponibilidad(fecha, horario, turnoId = null) {\r\n  try {\r\n    const config = await obtenerConfiguracion();\r\n    \r\n    // Convertir horario a minutos\r\n    const [hora, minuto] = horario.split(':').map(Number);\r\n    const inicioEnMinutos = hora * 60 + minuto;\r\n    const finEnMinutos = inicioEnMinutos + config.duracionTurno;\r\n    \r\n    // Convertir a formato HH:MM para la consulta\r\n    const horarioFin = `${Math.floor(finEnMinutos / 60).toString().padStart(2, '0')}:${(finEnMinutos % 60).toString().padStart(2, '0')}`;\r\n    \r\n    // Consultar todos los turnos para la fecha\r\n    let query = db.collection('turnos').where('fecha', '==', fecha);\r\n    \r\n    const snapshot = await query.get();\r\n    \r\n    // Filtrar localmente los turnos que se solapan\r\n    const turnosSolapados = snapshot.docs.filter(doc => {\r\n      // Si estamos editando, excluir el turno actual\r\n      if (turnoId && doc.id === turnoId) return false;\r\n      \r\n      const turno = doc.data();\r\n      const [turnoHora, turnoMinuto] = turno.horario.split(':').map(Number);\r\n      const turnoInicio = turnoHora * 60 + turnoMinuto;\r\n      const turnoFin = turnoInicio + config.duracionTurno;\r\n      \r\n      // Verificar solapamiento\r\n      return (inicioEnMinutos < turnoFin && finEnMinutos > turnoInicio);\r\n    });\r\n    \r\n    return {\r\n      disponible: turnosSolapados.length === 0,\r\n      mensaje: turnosSolapados.length > 0 ? `El horario se solapa con otro turno existente` : null\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error verificando disponibilidad:\", error);\r\n    return {\r\n      disponible: false,\r\n      mensaje: \"Error al verificar disponibilidad\"\r\n    };\r\n  }\r\n}\r\n\r\nasync function guardarCambiosTurno() {\r\n  if (!currentTurnoId) {\r\n    console.error('currentTurnoId no definido');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const user = firebase.auth().currentUser;\r\n    if (!user || user.uid !== ADMIN_UID) {\r\n      alert('No tienes permisos para realizar esta acción');\r\n      return;\r\n    }\r\n\r\n    const config = await obtenerConfiguracion();\r\n    const horario = document.getElementById('edit-horario').value;\r\n    const fechaInput = document.getElementById('edit-fecha').value;\r\n    \r\n    // Debug: Mostrar información de validación\r\n    console.log(\"Validando turno para:\", fechaInput, horario);\r\n    console.log(\"Configuración actual:\", config);\r\n\r\n    // Validar horario\r\n    const validacionHorario = validarHorario(horario, config);\r\n    if (!validacionHorario.valido) {\r\n      alert(validacionHorario.mensaje);\r\n      return;\r\n    }\r\n    \r\n    // Crear fecha sin problemas de zona horaria (formato YYYY-MM-DD)\r\n    const [year, month, day] = fechaInput.split('-').map(Number);\r\n    const fechaObj = new Date(year, month - 1, day);\r\n    \r\n    // Obtener día de la semana (0=Domingo, 1=Lunes, ..., 6=Sábado)\r\n    const diaSemana = fechaObj.getDay();\r\n    \r\n    // Debug: Verificar valores\r\n    console.log(\"Fecha seleccionada:\", fechaInput);\r\n    console.log(\"Día de la semana calculado:\", diaSemana);\r\n    console.log(\"Días laborales configurados:\", config.diasLaborales);\r\n    \r\n    // Validar día laboral\r\n    if (!config.diasLaborales.includes(diaSemana)) {\r\n      const diasNombres = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];\r\n      alert(`No se pueden agendar turnos los ${diasNombres[diaSemana]}s`);\r\n      return;\r\n    }\r\n    \r\n    // Verificar disponibilidad\r\n    const disponibilidad = await verificarDisponibilidad(fechaInput, horario, currentTurnoId);\r\n    if (!disponibilidad.disponible) {\r\n      alert(disponibilidad.mensaje);\r\n      return;\r\n    }\r\n    \r\n    // Solo actualizar fecha y horario\r\n    const turnoActualizado = {\r\n      fecha: fechaInput,\r\n      horario: horario,\r\n      actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n    };\r\n    \r\n    await db.collection('turnos').doc(currentTurnoId).update(turnoActualizado);\r\n    \r\n    // Actualizar la vista\r\n    await loadTurnosForDate(fechaInput);\r\n    if (calendar) {\r\n      calendar.refetchEvents();\r\n    }\r\n    elements.modalEditar.style.display = 'none';\r\n    \r\n    alert('Turno actualizado correctamente');\r\n  } catch (error) {\r\n    console.error(\"Error actualizando turno:\", error);\r\n    alert(\"Error al actualizar el turno: \" + error.message);\r\n  }\r\n}\r\n\r\nasync function eliminarTurno(turnoId) {\r\n  // Validación mejorada del ID\r\n  if (!turnoId || typeof turnoId !== 'string') {\r\n    console.error('ID de turno inválido:', turnoId);\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    console.log('Iniciando eliminación para ID:', turnoId);\r\n    \r\n    // Obtener la fecha del turno antes de eliminarlo\r\n    const doc = await db.collection('turnos').doc(turnoId).get();\r\n    if (!doc.exists) {\r\n      alert('El turno ya no existe');\r\n      return false;\r\n    }\r\n    \r\n    const fechaTurno = doc.data().fecha;\r\n    \r\n    // Eliminar el documento\r\n    await db.collection('turnos').doc(turnoId).delete();\r\n    console.log('Turno eliminado con éxito');\r\n    \r\n    // Actualizar la vista\r\n    await loadTurnosForDate(fechaTurno);\r\n    \r\n    // Refrescar calendario\r\n    if (calendar) {\r\n      calendar.refetchEvents();\r\n    }\r\n    \r\n    // Cerrar modal si está abierto\r\n    if (elements.modalEditar) {\r\n      elements.modalEditar.style.display = 'none';\r\n    }\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error al eliminar:', error);\r\n    alert('Error al eliminar el turno: ' + (error.message || 'Por favor intente nuevamente'));\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction setupModalEvents() {\r\n  const modal = document.getElementById('modal-editar');\r\n  const btnEliminar = document.getElementById('btn-eliminar-modal');\r\n  \r\n  if (btnEliminar) {\r\n    btnEliminar.onclick = async (e) => {\r\n      e.stopPropagation(); // Detener la propagación\r\n      e.preventDefault(); // Prevenir comportamiento por defecto\r\n      \r\n      if (!currentTurnoId) {\r\n        console.error('No hay turno seleccionado');\r\n        return;\r\n      }\r\n\r\n      if (confirm('¿Estás seguro de eliminar este turno permanentemente?')) {\r\n        try {\r\n          const success = await eliminarTurno(currentTurnoId);\r\n          if (success) {\r\n            // Actualizar la vista\r\n            const fechaActual = new Date().toISOString().split('T')[0];\r\n            await loadTurnosForDate(fechaActual);\r\n            calendar.refetchEvents();\r\n            modal.style.display = 'none';\r\n            alert('Turno eliminado correctamente');\r\n          }\r\n        } catch (error) {\r\n          console.error('Error en el proceso de eliminación:', error);\r\n          alert('Error al eliminar el turno: ' + (error.message || 'Por favor intente nuevamente'));\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', initAdmin);","(() => {\r\n  window.enviarEmailConfirmacion = async (datosTurno) => {\r\n    try {\r\n      const emailData = {\r\n        senderName: window.brevoConfig.senderName,\r\n        senderEmail: window.brevoConfig.senderEmail,\r\n        to: [{ email: datosTurno.email, name: datosTurno.nombre }],\r\n        subject: `Confirmación de turno - ${datosTurno.fecha} a las ${datosTurno.horario}`,\r\n        htmlContent: `\r\n          <!DOCTYPE html>\r\n          <html>\r\n          <head>\r\n              <style>\r\n                  body { font-family: 'Poppins', sans-serif; line-height: 1.6; color: #333; }\r\n                  .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n                  .header { background-color: #f8f1e9; padding: 20px; text-align: center; }\r\n                  .content { padding: 20px; }\r\n                  .footer { text-align: center; font-size: 12px; color: #777; margin-top: 20px; }\r\n                  .resumen { margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }\r\n                  .servicio { margin-bottom: 5px; }\r\n              </style>\r\n          </head>\r\n          <body>\r\n              <div class=\"container\">\r\n                  <div class=\"header\">\r\n                      <h2>Esvelta Peluquería</h2>\r\n                      <p>¡Tu turno ha sido confirmado!</p>\r\n                  </div>\r\n                  \r\n                  <div class=\"content\">\r\n                      <p>Hola <strong>${datosTurno.nombre}</strong>,</p>\r\n                      <p>Tu turno ha sido reservado con éxito. A continuación los detalles:</p>\r\n                      \r\n                      <div class=\"resumen\">\r\n                          <h3>Resumen de tu reserva</h3>\r\n                          <p><strong>Fecha:</strong> ${datosTurno.fecha}</p>\r\n                          <p><strong>Hora:</strong> ${datosTurno.horario}</p>\r\n                          <p><strong>Servicios:</strong></p>\r\n                          <ul>\r\n                              ${datosTurno.servicios.map(s => `<li class=\"servicio\">${s}</li>`).join('')}\r\n                          </ul>\r\n                          <p><strong>Seña abonada:</strong> $${datosTurno.reserva.toLocaleString()}</p>\r\n                          <p><strong>Saldo pendiente:</strong> $${(datosTurno.montoTotal - datosTurno.reserva).toLocaleString()}</p>\r\n                      </div>\r\n                      \r\n                      <p>Si necesitas modificar o cancelar tu turno, por favor contáctanos respondiendo este email.</p>\r\n                  </div>\r\n                  \r\n                  <div class=\"footer\">\r\n                      <p>© ${new Date().getFullYear()} Esvelta Peluquería. Todos los derechos reservados.</p>\r\n                  </div>\r\n              </div>\r\n          </body>\r\n          </html>\r\n        `\r\n      };\r\n\r\n      // Opcional: enviar copia al admin\r\n      if (window.brevoConfig.adminEmail) {\r\n        emailData.bcc = [{ email: window.brevoConfig.adminEmail, name: 'Administrador Esvelta' }];\r\n      }\r\n\r\n      // Llamar a la Cloud Function\r\n      const enviarEmail = firebase.functions().httpsCallable('enviarEmailConfirmacion');\r\n      const resultado = await enviarEmail(emailData);\r\n      \r\n      return resultado.data.success;\r\n    } catch (error) {\r\n      console.error('Error en enviarEmailConfirmacion:', error);\r\n      return false;\r\n    }\r\n  };\r\n})();","// Variables globales\r\nlet pasoActual = 1;\r\nconst totalPasos = 5; // Ahora son 5 pasos antes de confirmación\r\nlet datosReserva = {\r\n    servicios: [],\r\n    precios: {\r\n        \"Corte\": 15000,\r\n        \"Teñido\": 40000,\r\n        \"Alisado\": 30000\r\n    },\r\n    reserva: 5000,\r\n    fecha: null,\r\n    horario: null,\r\n    nombre: null,\r\n    email: null,\r\n    telefono: null,\r\n    observacion: null\r\n};\r\n\r\nlet usuarioActual = null;\r\n\r\n// Elementos DOM\r\nconst elementos = {\r\n    progreso: document.getElementById('progreso'),\r\n    btnAnterior: document.querySelector('.btn-anterior'),\r\n    btnSiguiente: document.querySelector('.btn-siguiente'),\r\n    pasos: document.querySelectorAll('.paso'),\r\n    // Elementos de resumen\r\n    resumenNombre: document.getElementById('cliente-nombre'),\r\n    resumenEmail: document.getElementById('cliente-email'),\r\n    resumenTelefono: document.getElementById('cliente-telefono'),\r\n    resumenServicio: document.getElementById('servicio-seleccionado'),\r\n    resumenFecha: document.getElementById('fecha-seleccionada'),\r\n    resumenHorario: document.getElementById('horario-seleccionado'),\r\n    resumenObservacion: document.getElementById('observacion-texto')\r\n};\r\n\r\n// Usar las referencias globales con validación\r\nconst auth = window.firebaseAuth || {\r\n  onAuthStateChanged: () => console.warn('Auth no inicializado'),\r\n  // otras funciones mock para desarrollo\r\n};\r\n\r\nif (!window.firestoreDB) {\r\n  console.error('Firestore no está disponible');\r\n  // Podrías mostrar un mensaje al usuario o deshabilitar funcionalidad\r\n}\r\n\r\n// Prueba de conexión (puedes eliminar esto después)\r\nasync function probarConexion() {\r\n  try {\r\n    // console.log(\"Probando conexión a Firestore...\");\r\n    \r\n    // 1. Obtener configuración\r\n    const config = await firestoreDB.obtenerConfiguracion();\r\n    // console.log(\"Configuración obtenida:\", config);\r\n    \r\n    // 2. Obtener turnos de hoy\r\n    const hoy = new Date().toISOString().split('T')[0];\r\n    const turnos = await firestoreDB.obtenerTurnosPorFecha(hoy);\r\n    // console.log(`Turnos para hoy (${hoy}):`, turnos);\r\n    \r\n    // 3. Generar horarios disponibles para hoy\r\n    const horarios = await firestoreDB.generarHorariosDisponibles(hoy);\r\n    // console.log(\"Horarios disponibles hoy:\", horarios);\r\n    \r\n  } catch (error) {\r\n    console.error(\"Error en prueba de conexión:\", error);\r\n  }\r\n}\r\n\r\n// Inicialización\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n\r\n  // Verificar si hay usuario en LocalStorage\r\n  const usuarioLS = localStorage.getItem('usuario');\r\n  if (usuarioLS) {\r\n    const user = JSON.parse(usuarioLS);\r\n    actualizarUIUsuario(user);\r\n  }\r\n\r\n  if (document.querySelector('.contenedor-pasos')) {\r\n    probarConexion();\r\n    inicializarEventos();\r\n    actualizarInterfaz();\r\n    inicializarAuth();\r\n    inicializarDisponibilidad();\r\n  }\r\n});\r\n\r\nfunction mostrarError(mensaje) {\r\n  const errorContainer = document.createElement('div');\r\n  errorContainer.className = 'error-global';\r\n  errorContainer.innerHTML = `\r\n    <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n      <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n    </svg>\r\n    <span>${mensaje}</span>\r\n  `;\r\n  \r\n  document.body.appendChild(errorContainer);\r\n  setTimeout(() => errorContainer.remove(), 5000);\r\n}\r\n\r\n// Funciones principales\r\nfunction inicializarEventos() {\r\n    // Navegación\r\n    elementos.btnAnterior.addEventListener('click', retrocederPaso);\r\n    elementos.btnSiguiente.addEventListener('click', avanzarPaso);\r\n    \r\n    // Selección de servicios (manejo delegado)\r\n    document.querySelectorAll('.flotante.servicio').forEach(servicio => {\r\n        servicio.addEventListener('click', function() {\r\n            this.classList.toggle('seleccionado');\r\n            actualizarServiciosSeleccionados();\r\n        });\r\n    });\r\n    \r\n    // Fechas y horarios\r\n    document.querySelectorAll('.flotante.fecha').forEach(fecha => {\r\n        fecha.addEventListener('click', function() {\r\n            seleccionarElemento(this, 'fecha');\r\n        });\r\n    });\r\n    \r\n    document.querySelectorAll('.flotante.horario').forEach(horario => {\r\n        horario.addEventListener('click', async function() {\r\n            if (!this.classList.contains('ocupado')) {\r\n            const horarioSeleccionado = this.querySelector('.p1').textContent;\r\n            const validacion = await validarDisponibilidadCompleta(\r\n                datosReserva.fecha, \r\n                horarioSeleccionado\r\n            );\r\n            \r\n            if (validacion.disponible && validacion.turnosSolapados.length === 0) {\r\n                seleccionarElemento(this, 'horario');\r\n            } else {\r\n                mostrarError(validacion.mensaje || \"Horario no disponible\");\r\n            }\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Validación en tiempo real\r\n    document.getElementById('nombre')?.addEventListener('input', validarNombre);\r\n    document.getElementById('email')?.addEventListener('input', validarEmail);\r\n    document.getElementById('telefono')?.addEventListener('input', validarTelefono);\r\n}\r\n\r\nfunction calcularSubtotal() {\r\n    const subtotal = datosReserva.servicios.reduce((total, servicio) => total + servicio.precio, 0);\r\n    document.getElementById('subtotal').textContent = `$${subtotal.toLocaleString()}`;\r\n    return subtotal;\r\n}\r\n\r\nfunction actualizarServiciosSeleccionados() {\r\n    const serviciosSeleccionados = document.querySelectorAll('.flotante.servicio.seleccionado');\r\n    datosReserva.servicios = Array.from(serviciosSeleccionados).map(serv => {\r\n        return {\r\n            nombre: serv.getAttribute('data-servicio'),\r\n            precio: datosReserva.precios[serv.getAttribute('data-servicio')]\r\n        };\r\n    });\r\n    \r\n    // Actualizar contador\r\n    document.getElementById('contador-servicios').textContent = datosReserva.servicios.length;\r\n    \r\n    // Ocultar error si hay selección\r\n    if (datosReserva.servicios.length > 0) {\r\n        document.getElementById('error-servicio').classList.remove('visible');\r\n    }\r\n    \r\n    // Calcular y mostrar subtotal\r\n    calcularSubtotal();\r\n}\r\n\r\nasync function avanzarPaso() {\r\n    if (pasoActual >= totalPasos) return;\r\n    \r\n    try {\r\n        const pasoValido = await validarPaso(pasoActual);\r\n        if (!pasoValido) {\r\n            return;\r\n        }\r\n\r\n        pasoActual++;\r\n        actualizarInterfaz();\r\n        \r\n        if (pasoActual === 4 && usuarioActual) {\r\n            autocompletarFormulario(usuarioActual);\r\n        }\r\n        \r\n        if (pasoActual === 5) {\r\n            guardarDatosFormulario();\r\n            actualizarResumen();\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al avanzar paso:', error);\r\n        mostrarError('Ocurrió un error al validar los datos');\r\n    }\r\n}\r\n\r\nfunction retrocederPaso() {\r\n    if (pasoActual > 1) {\r\n        pasoActual--;\r\n        actualizarInterfaz();\r\n    }\r\n}\r\n\r\nfunction actualizarInterfaz() {\r\n    actualizarPasos();\r\n    actualizarProgreso();\r\n    actualizarBotones();\r\n}\r\n\r\nasync function simularReserva() {\r\n  if (pasoActual === totalPasos) {\r\n    // Mostrar spinner y deshabilitar botón\r\n    const loader = document.getElementById('reserva-loader');\r\n    const btnSiguiente = document.querySelector('.btn-siguiente');\r\n\r\n    const duracionTotal = datosReserva.servicios.length * 30; // 30 min por servicio\r\n\r\n    btnSiguiente.classList.add('hidden');\r\n    // Esperar a que termine la transición antes de mostrar el spinner\r\n    setTimeout(() => {\r\n      loader.style.display = 'inline-block';\r\n    }, 200); // Mismo tiempo que la transición CSS\r\n    \r\n    // Aplicar cambios de visibilidad de forma síncrona\r\n    requestAnimationFrame(() => {\r\n      btnSiguiente.style.display = 'none';  // Ocultar botón primero\r\n      loader.style.display = 'inline-block'; // Luego mostrar spinner\r\n    });\r\n\r\n    const validacion = await validarDisponibilidadCompleta(\r\n      datosReserva.fecha, \r\n      datosReserva.horario,\r\n      duracionTotal\r\n    );\r\n\r\n    if (!validacion.disponible || validacion.turnosSolapados.length > 0) {\r\n      // Restaurar UI si hay error\r\n      requestAnimationFrame(() => {\r\n        loader.style.display = 'none';\r\n        btnSiguiente.style.display = 'flex'; // Usar display original del botón\r\n      });\r\n      \r\n      mostrarError(validacion.mensaje || \"El horario ya no está disponible\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Validar disponibilidad\r\n      const disponible = await firestoreDB.verificarDisponibilidad(\r\n        datosReserva.fecha, \r\n        datosReserva.horario\r\n      );\r\n      \r\n      if (!disponible) {\r\n        mostrarConfirmacion(false);\r\n        return;\r\n      }\r\n  \r\n      // Crear objeto de turno\r\n      const turnoData = {\r\n        cliente: datosReserva.nombre,\r\n        email: datosReserva.email,\r\n        telefono: datosReserva.telefono,\r\n        servicios: datosReserva.servicios.map(s => s.nombre),\r\n        fecha: datosReserva.fecha,\r\n        horario: datosReserva.horario,\r\n        montoTotal: calcularSubtotal(),\r\n        reserva: datosReserva.reserva,\r\n        observaciones: datosReserva.observacion || '',\r\n        userId: usuarioActual?.uid || null,\r\n        duracion: duracionTotal\r\n      };\r\n  \r\n      // Guardar en Firestore\r\n      await firestoreDB.guardarTurno(turnoData);\r\n      \r\n      // Enviar email de confirmación (no esperamos respuesta para no bloquear la UI)\r\n      enviarEmailConfirmacion({\r\n        ...turnoData,\r\n        nombre: datosReserva.nombre,\r\n        servicios: datosReserva.servicios.map(s => s.nombre)\r\n      }).then(enviado => {\r\n        if (!enviado) {\r\n          console.log(\"El email no pudo enviarse, pero el turno fue reservado\");\r\n        }\r\n      });\r\n\r\n      // Ocultar spinner después de la reserva exitosa\r\n      loader.style.display = 'none';\r\n      \r\n      // Mostrar confirmación\r\n      mostrarConfirmacion(true);\r\n      \r\n    } catch (error) {\r\n      console.error('Error al reservar:', error);\r\n      // Restaurar UI si hay error\r\n      requestAnimationFrame(() => {\r\n        loader.style.display = 'none';\r\n        btnSiguiente.style.display = 'flex'; // Usar display original del botón\r\n      });\r\n      mostrarConfirmacion(false);\r\n    }\r\n  }\r\n}\r\n\r\nasync function completarReserva() {\r\n  let bloqueoId = null;\r\n  \r\n  try {\r\n    // 1. Crear bloqueo (con ID automático)\r\n    bloqueoId = await firestoreDB.bloquearTurnoTemporal(\r\n      datosReserva.fecha,\r\n      datosReserva.horario,\r\n      usuarioActual?.uid || 'anonimo'\r\n    );\r\n\r\n    // 2. Validación final\r\n    const config = await firestoreDB.obtenerConfiguracion();\r\n    const [disponible, turnosSolapados] = await Promise.all([\r\n      firestoreDB.verificarDisponibilidad(datosReserva.fecha, datosReserva.horario),\r\n      firestoreDB.obtenerTurnosSolapados(\r\n        datosReserva.fecha, \r\n        datosReserva.horario,\r\n        config.duracionTurno\r\n      )\r\n    ]);\r\n\r\n    if (!disponible || turnosSolapados.length > 0) {\r\n      await firestoreDB.eliminarBloqueoTemporal(bloqueoId);\r\n      mostrarError(turnosSolapados.length > 0 \r\n        ? `El horario se solapa con un turno existente (${turnosSolapados[0].servicios.join(', ')})`\r\n        : \"El horario ya fue reservado\");\r\n      return;\r\n    }\r\n\r\n    // 3. Guardar turno\r\n    const turnoData = { /* ... tus datos de turno ... */ };\r\n    await firestoreDB.guardarTurno(turnoData);\r\n\r\n    // 4. Limpiar bloqueo\r\n    await firestoreDB.eliminarBloqueoTemporal(bloqueoId);\r\n\r\n    mostrarConfirmacion(true);\r\n  } catch (error) {\r\n    console.error(\"Error en reserva:\", error);\r\n    if (bloqueoId) {\r\n      await firestoreDB.eliminarBloqueoTemporal(bloqueoId).catch(e => console.error(\"Error limpiando bloqueo:\", e));\r\n    }\r\n    mostrarConfirmacion(false);\r\n  }\r\n}\r\n\r\n// Simular disponibilidad de turnos\r\nasync function inicializarDisponibilidad() {\r\n  try {\r\n    const config = await firestoreDB.obtenerConfiguracion();\r\n    // console.log(\"Configuración procesada:\", {\r\n    //   apertura: config.horarioApertura,\r\n    //   cierre: config.horarioCierre,\r\n    //   diasLaborales: config.diasLaborales,\r\n    //   diasNoLaborables: config.diasNoLaborables\r\n    // });\r\n\r\n    const fechasDisponibles = generarFechasDisponibles(config);\r\n    // console.log(\"Fechas generadas:\", fechasDisponibles);\r\n    \r\n    actualizarUIFechas(fechasDisponibles);\r\n  } catch (error) {\r\n    console.error(\"Error inicializando disponibilidad:\", error);\r\n    mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n  }\r\n}\r\n\r\nasync function validarDisponibilidadCompleta(fecha, horario) {\r\n  try {\r\n    const config = await firestoreDB.obtenerConfiguracion();\r\n    const [disponible, turnosSolapados] = await Promise.all([\r\n      firestoreDB.verificarDisponibilidad(fecha, horario),\r\n      firestoreDB.obtenerTurnosSolapados(fecha, horario, config.duracionTurno)\r\n    ]);\r\n\r\n    return {\r\n      disponible,\r\n      turnosSolapados,\r\n      mensaje: turnosSolapados.length > 0 ? \r\n        `El horario se solapa con ${turnosSolapados.length} turno(s) existente(s)` : \r\n        null\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error en validación:\", error);\r\n    return {\r\n      disponible: false,\r\n      turnosSolapados: [],\r\n      mensaje: \"Error al verificar disponibilidad\"\r\n    };\r\n  }\r\n}\r\n\r\n// Nueva función para generar fechas disponibles\r\nfunction generarFechasDisponibles(config) {\r\n  // Obtener fecha y hora actual en Argentina (UTC-3)\r\n  const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n  const hoyArg = new Date(ahoraArg.getFullYear(), ahoraArg.getMonth(), ahoraArg.getDate());\r\n  \r\n  // Verificar si ya pasó el horario de cierre (usando hora Argentina)\r\n  const [horaCierre, minCierre] = config.horarioCierre.split(':').map(Number);\r\n  const empezarDesdeManana = ahoraArg.getHours() > horaCierre || \r\n                       (ahoraArg.getHours() === horaCierre && ahoraArg.getMinutes() >= minCierre);\r\n\r\n  const fechasDisponibles = [];\r\n  const DIAS_A_MOSTRAR = 7;\r\n  \r\n  // Comenzar desde hoy o mañana según horario\r\n  const diaInicial = empezarDesdeManana ? 1 : 0;\r\n  \r\n  for (let i = diaInicial; i < DIAS_A_MOSTRAR + diaInicial; i++) {\r\n    const fecha = new Date(hoyArg);\r\n    fecha.setDate(hoyArg.getDate() + i);\r\n    \r\n    // Verificar día laboral (usando fecha Argentina)\r\n    if (!esDiaLaboral(fecha, config)) {\r\n      // console.log(`Saltando ${fecha.toDateString()} - No es día laboral`);\r\n      continue;\r\n    }\r\n    \r\n    const fechaStr = fecha.toISOString().split('T')[0];\r\n    \r\n    // Verificar días no laborables\r\n    if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n      // console.log(`Saltando ${fechaStr} - Día no laborable configurado`);\r\n      continue;\r\n    }\r\n    \r\n    // No agregar hoy si ya pasó el horario de cierre\r\n    if (i === 0 && empezarDesdeManana) continue;\r\n    \r\n    fechasDisponibles.push({\r\n      fecha: fechaStr,\r\n      display: formatearFechaDisplay(fecha)\r\n    });\r\n  }\r\n  \r\n  // console.log(\"Fechas disponibles generadas:\", fechasDisponibles);\r\n  return fechasDisponibles;\r\n}\r\n\r\nfunction esDiaLaboral(fecha, config) {\r\n  const diaSemana = fecha.getDay(); // 0=Domingo, 1=Lunes, etc.\r\n  \r\n  // Asegurarnos que diasLaborales es un array de números válidos\r\n  let diasLaborales = [];\r\n  \r\n  try {\r\n    if (Array.isArray(config.diasLaborales)) {\r\n      diasLaborales = config.diasLaborales.map(Number).filter(n => !isNaN(n));\r\n    } else if (typeof config.diasLaborales === 'string') {\r\n      diasLaborales = config.diasLaborales.split(',').map(Number).filter(n => !isNaN(n));\r\n    }\r\n  } catch (e) {\r\n    console.error(\"Error procesando días laborales:\", e);\r\n    diasLaborales = [1,2,3,4,5]; // Valor por defecto: Lunes a Viernes\r\n  }\r\n  \r\n  // Si no hay días definidos, usar valor por defecto\r\n  if (diasLaborales.length === 0) {\r\n    diasLaborales = [1,2,3,4,5];\r\n  }\r\n  \r\n  return diasLaborales.includes(diaSemana);\r\n}\r\n\r\nfunction formatearFechaDisplay(fecha) {\r\n  return fecha.toLocaleDateString('es-AR', {\r\n    weekday: 'long',\r\n    day: 'numeric',\r\n    month: 'short'\r\n  });\r\n}\r\n\r\nfunction obtenerFechaSeleccionada() {\r\n  // Asume que la fecha está en formato \"Lunes 9/01\" o similar\r\n  // Necesitas convertir esto a un formato que coincida con tu DB (YYYY-MM-DD)\r\n  if (!datosReserva.fecha) return new Date().toISOString().split('T')[0];\r\n  \r\n  // Implementación básica - ajusta según tu formato de fecha\r\n  const partes = datosReserva.fecha.split(' ');\r\n  const [dia, mes] = partes[1].split('/');\r\n  const año = new Date().getFullYear();\r\n  \r\n  return `${año}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;\r\n}\r\n\r\nfunction actualizarUIFechas(fechasDisponibles) {\r\n  const paso2 = document.querySelector('.paso-2');\r\n  if (!paso2) {\r\n    console.error('No se encontró el contenedor del paso 2');\r\n    return;\r\n  }\r\n\r\n  const contenedorFechas = paso2.querySelector('.contenedor-fechas');\r\n  const plantillaFecha = paso2.querySelector('.flotante.fecha');\r\n  const cargando = paso2.querySelector('.cargando-fechas');\r\n  const sinFechas = paso2.querySelector('.sin-fechas');\r\n\r\n  // Ocultar mensaje de carga y limpiar contenedor\r\n  if (cargando) cargando.style.display = 'none';\r\n  if (sinFechas) sinFechas.style.display = 'none';\r\n  contenedorFechas.innerHTML = '';\r\n\r\n  if (plantillaFecha) {\r\n    plantillaFecha.style.display = 'none';\r\n  }\r\n\r\n  if (fechasDisponibles.length === 0) {\r\n    if (sinFechas) {\r\n      sinFechas.style.display = 'block';\r\n      sinFechas.textContent = 'No hay fechas disponibles en este momento';\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Mostrar fechas disponibles\r\n  contenedorFechas.style.display = 'grid';\r\n  fechasDisponibles.forEach(fecha => {\r\n    if (!plantillaFecha) return;\r\n    \r\n    const nuevoElemento = plantillaFecha.cloneNode(true);\r\n    nuevoElemento.style.display = 'flex';\r\n    nuevoElemento.querySelector('.p1').textContent = fecha.display;\r\n    nuevoElemento.dataset.fechaReal = fecha.fecha;\r\n    \r\n    nuevoElemento.addEventListener('click', function() {\r\n      seleccionarElemento(this, 'fecha');\r\n      cargarHorariosParaFecha(fecha.fecha);\r\n    });\r\n    \r\n    contenedorFechas.appendChild(nuevoElemento);\r\n  });\r\n}\r\n\r\nasync function cargarHorariosParaFecha(fecha) {\r\n  const paso3 = document.querySelector('.paso-3');\r\n  if (!paso3) return;\r\n\r\n  // Resetear estado primero\r\n  const contenedor = paso3.querySelector('.contenedor-horarios');\r\n  const sinHorarios = paso3.querySelector('.sin-horarios');\r\n  \r\n  if (contenedor) contenedor.innerHTML = '';\r\n  if (sinHorarios) sinHorarios.style.display = 'none';\r\n\r\n  // Mostrar carga\r\n  const cargando = paso3.querySelector('.cargando-horarios');\r\n  if (cargando) cargando.style.display = 'block';\r\n\r\n  try {\r\n    // console.log(\"Cargando horarios para fecha:\", fecha);\r\n    let horarios = await firestoreDB.generarHorariosDisponibles(fecha);\r\n    // console.log(\"Horarios recibidos:\", horarios);\r\n    \r\n    // Obtener fecha actual en Argentina (UTC-3)\r\n    const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n    const hoyArg = new Date(ahoraArg.getFullYear(), ahoraArg.getMonth(), ahoraArg.getDate());\r\n    const fechaSeleccionada = new Date(fecha + 'T00:00:00-03:00'); // Forzar zona horaria Argentina\r\n    \r\n    // Si es hoy, filtrar los horarios que ya pasaron o están muy próximos\r\n    if (fechaSeleccionada.getTime() === hoyArg.getTime()) {\r\n      const ahoraEnMinutos = ahoraArg.getHours() * 60 + ahoraArg.getMinutes();\r\n      const tiempoMinimoReserva = 30; // 30 minutos de anticipación\r\n      \r\n      horarios = horarios.filter(horario => {\r\n        const [horas, minutos] = horario.hora.split(':').map(Number);\r\n        const horarioEnMinutos = horas * 60 + minutos;\r\n        \r\n        // Solo mostrar horarios que tengan al menos 30 minutos de diferencia\r\n        return horarioEnMinutos >= ahoraEnMinutos + tiempoMinimoReserva;\r\n      });\r\n      \r\n      // console.log(\"Horarios filtrados para hoy:\", horarios);\r\n    }\r\n    \r\n    // Guardar fecha seleccionada\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // Actualizar UI\r\n    actualizarUIHorarios(horarios);\r\n    \r\n  } catch (error) {\r\n    console.error(\"Error cargando horarios:\", error);\r\n    if (sinHorarios) {\r\n      sinHorarios.style.display = 'block';\r\n      sinHorarios.textContent = 'Error al cargar horarios. Intenta nuevamente.';\r\n    }\r\n  } finally {\r\n    if (cargando) cargando.style.display = 'none';\r\n    if (contenedor) contenedor.style.display = 'grid';\r\n  }\r\n}\r\n\r\nasync function generarHorariosDisponibles(fecha) {\r\n  const [config, turnosOcupados] = await Promise.all([\r\n    this.obtenerConfiguracion(),\r\n    this.obtenerTurnosPorFecha(fecha)\r\n  ]);\r\n  \r\n  const horariosOcupados = turnosOcupados.map(t => t.horario);\r\n  const horarios = this._generarHorarios(config, horariosOcupados, fecha);\r\n  \r\n  // console.log(\"Horarios generados para\", fecha, \":\", horarios);\r\n  return horarios;\r\n}\r\n\r\nfunction actualizarUIHorarios(horariosDisponibles) {\r\n  const paso3 = document.querySelector('.paso-3');\r\n  if (!paso3) return;\r\n\r\n  const contenedor = paso3.querySelector('.contenedor-horarios');\r\n  const plantilla = paso3.querySelector('.flotante.horario');\r\n  const sinHorarios = paso3.querySelector('.sin-horarios');\r\n  \r\n  // Limpiar contenedor completamente\r\n  if (contenedor) contenedor.innerHTML = '';\r\n  if (sinHorarios) sinHorarios.style.display = 'none';\r\n\r\n  // Mostrar mensaje si no hay horarios\r\n  if (!horariosDisponibles || horariosDisponibles.length === 0) {\r\n    if (sinHorarios) {\r\n      sinHorarios.style.display = 'block';\r\n      sinHorarios.textContent = 'No hay horarios disponibles para esta fecha';\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Crear elementos de horarios\r\n  horariosDisponibles.forEach(horario => {\r\n    const elemento = document.createElement('div');\r\n    elemento.className = 'flotante horario';\r\n    elemento.style.display = 'flex';\r\n    \r\n    // Crear elementos internos\r\n    const p1 = document.createElement('p');\r\n    p1.className = 'p1';\r\n    p1.textContent = horario.hora;\r\n    \r\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    svg.setAttribute('class', 'check-icon');\r\n    svg.setAttribute('viewBox', '0 0 24 24');\r\n    \r\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    path.setAttribute('d', 'M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z');\r\n    \r\n    svg.appendChild(path);\r\n    \r\n    // Ensamblar el elemento\r\n    elemento.appendChild(p1);\r\n    elemento.appendChild(svg);\r\n    \r\n    // Solo agregar la clase .ocupado si no está disponible\r\n    if (!horario.disponible) {\r\n      elemento.classList.add('ocupado');\r\n    } else {\r\n      elemento.addEventListener('click', () => {\r\n        seleccionarElemento(elemento, 'horario');\r\n        datosReserva.horario = horario.hora;\r\n      });\r\n    }\r\n    \r\n    if (contenedor) contenedor.appendChild(elemento);\r\n  });\r\n}\r\n\r\nasync function verificarDisponibilidadEnTiempoReal(fecha, horario) {\r\n  try {\r\n    const disponible = await firestoreDB.verificarDisponibilidad(fecha, horario);\r\n    if (!disponible) {\r\n      mostrarError('Este horario ya no está disponible. Por favor selecciona otro.');\r\n      // Remover el horario ocupado de la UI\r\n      document.querySelectorAll('.flotante.horario').forEach(el => {\r\n        if (el.textContent.trim() === horario) {\r\n          el.classList.add('ocupado');\r\n          el.removeEventListener('click', manejarClickHorario);\r\n        }\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error verificando disponibilidad:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Función auxiliar para crear el contenedor si no existe\r\nfunction crearContenedorHorarios(paso3) {\r\n  const contenedor = document.createElement('div');\r\n  contenedor.className = 'contenedor-horarios';\r\n  paso3.appendChild(contenedor);\r\n  return contenedor;\r\n}\r\n\r\n// Funciones de apoyo\r\nfunction actualizarPasos() {\r\n    elementos.pasos.forEach((paso, index) => {\r\n        paso.classList.toggle('activo', index + 1 === pasoActual);\r\n    });\r\n}\r\n\r\nfunction actualizarProgreso() {\r\n    const porcentaje = (pasoActual / totalPasos) * 100;\r\n    elementos.progreso.style.width = `${porcentaje}%`;\r\n}\r\n\r\nfunction actualizarBotones() {\r\n    // Ocultar spinner al cambiar de paso\r\n    const loader = document.getElementById('reserva-loader');\r\n    if (loader) loader.style.display = 'none';\r\n\r\n    // Botón anterior\r\n    if (pasoActual === 1) {\r\n        elementos.btnAnterior.classList.remove('activo');\r\n    } else {\r\n        elementos.btnAnterior.classList.add('activo');\r\n    }\r\n    \r\n    // Limpiar eventos previos del botón siguiente\r\n    elementos.btnSiguiente.replaceWith(elementos.btnSiguiente.cloneNode(true));\r\n    elementos.btnSiguiente = document.querySelector('.btn-siguiente');\r\n    \r\n    // Configurar botón siguiente según el paso actual\r\n    if (pasoActual === totalPasos) {\r\n        elementos.btnSiguiente.classList.add('btn-reserva');\r\n        elementos.btnSiguiente.textContent = 'Reservar';\r\n        elementos.btnSiguiente.addEventListener('click', async () => {\r\n            await simularReserva();\r\n        });\r\n    } else {\r\n        elementos.btnSiguiente.classList.remove('btn-reserva');\r\n        elementos.btnSiguiente.innerHTML = `\r\n            <svg class=\"flecha\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n                <path d=\"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z\" fill=\"ffffff\"/>\r\n            </svg>\r\n        `;\r\n        elementos.btnSiguiente.addEventListener('click', avanzarPaso);\r\n    }\r\n}\r\n\r\nfunction seleccionarElemento(elemento, tipo) {\r\n    // Si ya está seleccionado y es servicio, deseleccionar\r\n    if (elemento.classList.contains('seleccionado') && tipo === 'servicio') {\r\n        elemento.classList.remove('seleccionado');\r\n        actualizarServiciosSeleccionados();\r\n        return;\r\n    }\r\n\r\n    // Para servicios (selección múltiple)\r\n    if (tipo === 'servicio') {\r\n        elemento.classList.add('seleccionado');\r\n        actualizarServiciosSeleccionados();\r\n    } \r\n    // Para fechas/horarios (selección única)\r\n    else {\r\n        document.querySelectorAll(`.flotante.${tipo}`).forEach(el => {\r\n            el.classList.remove('seleccionado');\r\n        });\r\n        elemento.classList.add('seleccionado');\r\n        datosReserva[tipo] = elemento.querySelector('.p1').textContent;\r\n        \r\n        // Remover mensaje de error si se selecciona\r\n        if (tipo === 'fecha') {\r\n            document.getElementById('error-fecha').classList.remove('visible');\r\n        } else if (tipo === 'horario') {\r\n            document.getElementById('error-horario').classList.remove('visible');\r\n        }\r\n    }\r\n}\r\n\r\nasync function validarPaso(paso) {\r\n    const pasoElement = document.querySelector(`.paso-${paso}`);\r\n    if (!pasoElement) {\r\n        console.error(`Elemento del paso ${paso} no encontrado`);\r\n        return false;\r\n    }\r\n\r\n    // Ocultar todos los mensajes de error primero\r\n    const errores = pasoElement.querySelectorAll('.error-mensaje');\r\n    if (errores) {\r\n        errores.forEach(msg => msg.classList.remove('visible'));\r\n    }\r\n\r\n    switch (paso) {\r\n       case 1: \r\n        const errorServicio = pasoElement.querySelector('#error-servicio');\r\n        if (datosReserva.servicios.length === 0) {\r\n            if (errorServicio) {\r\n                errorServicio.classList.add('visible');\r\n                errorServicio.style.animation = 'shake 0.5s';\r\n                setTimeout(() => errorServicio.style.animation = '', 500);\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n            \r\n        case 2:\r\n            const errorFecha = pasoElement.querySelector('#error-fecha');\r\n            if (!datosReserva.fecha) {\r\n                if (errorFecha) errorFecha.classList.add('visible');\r\n                return false;\r\n            }\r\n            return true;\r\n            \r\n        case 3:\r\n          const errorHorario = pasoElement.querySelector('#error-horario');\r\n          if (!datosReserva.horario) {\r\n              if (errorHorario) errorHorario.classList.add('visible');\r\n              return false;\r\n          }\r\n          \r\n          // Validar disponibilidad considerando duración\r\n          const duracionTotal = datosReserva.servicios.length * 30; // 30 min por servicio\r\n          const disponible = await firestoreDB.verificarDisponibilidad(\r\n              datosReserva.fecha, \r\n              datosReserva.horario,\r\n              duracionTotal\r\n          );\r\n          \r\n          if (!disponible) {\r\n              mostrarError('El horario ya no está disponible para la duración requerida');\r\n              return false;\r\n          }\r\n          return true;\r\n            \r\n        case 4:\r\n            return validarFormulario();\r\n            \r\n        default:\r\n            return true;\r\n    }\r\n}\r\n\r\nfunction validarFormulario() {\r\n    let valido = true;\r\n    const nombre = document.getElementById('nombre').value.trim();\r\n    const email = document.getElementById('email').value.trim();\r\n    const telefono = document.getElementById('telefono').value.trim();\r\n    \r\n    // Ocultar todos los mensajes primero\r\n    document.querySelectorAll('.error-mensaje').forEach(msg => {\r\n        msg.classList.remove('visible');\r\n    });\r\n    \r\n    // Validar nombre\r\n    if (!nombre || nombre.length < 5) {\r\n        document.getElementById('error-nombre').classList.add('visible');\r\n        document.getElementById('nombre').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    // Validar email\r\n    if (!email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\r\n        document.getElementById('error-email').classList.add('visible');\r\n        document.getElementById('email').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    // Validar teléfono\r\n    if (!telefono || !/^[0-9]{10}$/.test(telefono)) {\r\n        document.getElementById('error-telefono').classList.add('visible');\r\n        document.getElementById('telefono').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction guardarDatosFormulario() {\r\n    datosReserva.nombre = document.getElementById('nombre').value.trim();\r\n    datosReserva.email = document.getElementById('email').value.trim();\r\n    datosReserva.telefono = document.getElementById('telefono').value.trim();\r\n    datosReserva.observacion = document.getElementById('observacion').value.trim() || 'Ninguna';\r\n}\r\n\r\nfunction actualizarResumen() {\r\n    // Verificar que los elementos existen antes de acceder\r\n    if (elementos.resumenNombre) {\r\n        elementos.resumenNombre.textContent = datosReserva.nombre || \"[No ingresado]\";\r\n    }\r\n    \r\n    const emailElement = document.getElementById('cliente-email');\r\n    if (emailElement) {\r\n        emailElement.textContent = datosReserva.email || \"[No ingresado]\";\r\n    }\r\n    \r\n    if (elementos.resumenTelefono) {\r\n        elementos.resumenTelefono.textContent = datosReserva.telefono || \"[No ingresado]\";\r\n    }\r\n    \r\n    // Servicios seleccionados\r\n    const listaServicios = datosReserva.servicios.length > 0\r\n        ? datosReserva.servicios.map(s => `${s.nombre}`).join(\", \")\r\n        : \"Ninguno seleccionado\";\r\n    elementos.resumenServicio.innerHTML = listaServicios;\r\n    \r\n    // Fecha y hora\r\n    elementos.resumenFecha.textContent = datosReserva.fecha || \"[No seleccionada]\";\r\n    elementos.resumenHorario.textContent = datosReserva.horario || \"[No seleccionado]\";\r\n    elementos.resumenObservacion.textContent = datosReserva.observacion;\r\n    \r\n    // Cálculos de precios\r\n    const subtotal = calcularSubtotal();\r\n    const saldoPendiente = Math.max(0, subtotal - datosReserva.reserva); // No negativo\r\n    \r\n    document.getElementById('subtotal').textContent = `$${subtotal.toLocaleString()}`;\r\n    document.getElementById('senia').textContent = `$${datosReserva.reserva.toLocaleString()}`;\r\n    document.getElementById('saldo-pendiente').textContent = `$${saldoPendiente.toLocaleString()}`;\r\n}\r\n\r\nfunction validarNombre() {\r\n    const input = document.getElementById('nombre');\r\n    const errorMsg = document.getElementById('error-nombre');\r\n    \r\n    if (input.value.trim().length >= 5) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n    }\r\n}\r\n\r\nfunction validarTelefono() {\r\n    const input = document.getElementById('telefono');\r\n    const errorMsg = document.getElementById('error-telefono');\r\n    \r\n    if (/^[0-9]{10}$/.test(input.value)) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n    }\r\n}\r\n\r\n// Nueva función para validar email\r\nfunction validarEmail() {\r\n    const input = document.getElementById('email');\r\n    const errorMsg = document.getElementById('error-email');\r\n    \r\n    if (/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(input.value)) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n    }\r\n}\r\n\r\nasync function mostrarConfirmacion(exito) {\r\n    // Ocultar todos los pasos\r\n    elementos.pasos.forEach(paso => paso.classList.remove('activo'));\r\n    \r\n    // Mostrar paso de confirmación\r\n    const paso6 = document.querySelector('.paso-6');\r\n    paso6.classList.add('activo');\r\n    \r\n    // SVG para éxito y error\r\n    const successSVG = `\r\n      <svg class=\"confirmacion-icono\" viewBox=\"0 0 24 24\">\r\n        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/>\r\n      </svg>\r\n    `;\r\n    \r\n    const errorSVG = `\r\n      <svg class=\"confirmacion-icono\" viewBox=\"0 0 24 24\">\r\n        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n      </svg>\r\n    `;\r\n    \r\n    // Botón SVG\r\n    const buttonSVG = `\r\n      <svg viewBox=\"0 0 24 24\">\r\n        <path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"/>\r\n      </svg>\r\n    `;\r\n\r\n    // Mostrar el estado correspondiente\r\n    if (exito) {\r\n        const subtotal = datosReserva.servicios.reduce((total, servicio) => total + servicio.precio, 0);\r\n        const saldoPendiente = Math.max(0, subtotal - datosReserva.reserva);\r\n        \r\n        const exitoContainer = document.querySelector('.paso-6 .exito');\r\n        exitoContainer.innerHTML = `\r\n            ${successSVG}\r\n            <h2>¡Turno reservado!</h2>\r\n            <p>Nos vemos en la pelu. Recibirás un email de confirmación.</p>\r\n            <div class=\"resumen-confirmacion\">\r\n                <h3>Resumen de tu reserva</h3>\r\n                <p><strong>Servicios:</strong> ${datosReserva.servicios.map(s => s.nombre).join(', ')}</p>\r\n                <p><strong>Fecha:</strong> ${datosReserva.fecha}</p>\r\n                <p><strong>Hora:</strong> ${datosReserva.horario}</p>\r\n                <p><strong>Seña abonada:</strong> $${datosReserva.reserva.toLocaleString()}</p>\r\n                <p class=\"total-confirmacion\">Saldo pendiente: $${saldoPendiente.toLocaleString()}</p>\r\n            </div>\r\n        `;\r\n        \r\n        document.querySelector('.paso-6 .exito').classList.add('visible');\r\n        document.querySelector('.paso-6 .error').classList.remove('visible');\r\n    } else {\r\n        const errorContainer = document.querySelector('.paso-6 .error');\r\n        errorContainer.innerHTML = `\r\n            ${errorSVG}\r\n            <h2>No se pudo realizar la reserva</h2>\r\n            <p>Intenta nuevamente en unos minutos.</p>\r\n        `;\r\n        \r\n        document.querySelector('.paso-6 .exito').classList.remove('visible');\r\n        document.querySelector('.paso-6 .error').classList.add('visible');\r\n    }\r\n    \r\n    // Ocultar controles de navegación\r\n    elementos.btnAnterior.style.display = 'none';\r\n    elementos.btnSiguiente.style.display = 'none';\r\n    \r\n    // Botón para nueva reserva\r\n    if (!document.getElementById('nueva-reserva')) {\r\n        const botonNuevaReserva = `\r\n            <button id=\"nueva-reserva\" class=\"btn-reserva\">\r\n                ${buttonSVG}\r\n                ${exito ? 'Volver' : 'Volver a intentar'}\r\n            </button>\r\n        `;\r\n        paso6.insertAdjacentHTML('beforeend', botonNuevaReserva);\r\n        \r\n        document.getElementById('nueva-reserva').addEventListener('click', () => {\r\n            location.reload();\r\n        });\r\n    }\r\n}\r\n\r\n//////////////////////////////////////////\r\n//////////// Autenticacion //////////////\r\n/////////////////////////////////////////\r\n\r\nfunction inicializarAuth() {\r\n  const authContainer = document.querySelector('nav');\r\n  if (!authContainer) return;\r\n\r\n  // Crear botón si no existe\r\n  if (!document.getElementById('btn-google')) {\r\n    authContainer.innerHTML += '<button id=\"btn-google\">Acceder</button>';\r\n  }\r\n\r\n  // Manejar estado de autenticación\r\n  firebase.auth().onAuthStateChanged(user => {\r\n    usuarioActual = user;\r\n    const btnGoogle = document.getElementById('btn-google');\r\n    \r\n    if (user) {\r\n      // Reemplazar botón con nombre\r\n      btnGoogle.outerHTML = `<p class=\"usuario-nombre\">${user.displayName}</p>`;\r\n      guardarUsuario(user);\r\n    } else {\r\n      // Asegurarse que el botón existe\r\n      if (!document.getElementById('btn-google')) {\r\n        authContainer.innerHTML += '<button id=\"btn-google\">Acceder</button>';\r\n      }\r\n      limpiarUsuario();\r\n    }\r\n  });\r\n\r\n  // Delegación de eventos para el botón dinámico\r\n  document.querySelector('nav').addEventListener('click', async (e) => {\r\n    if (e.target.id === 'btn-google') {\r\n      try {\r\n        const provider = new firebase.auth.GoogleAuthProvider();\r\n        await firebase.auth().signInWithPopup(provider);\r\n      } catch (error) {\r\n        console.error('Error de autenticación:', error);\r\n        alert('Error al iniciar sesión: ' + error.message);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n// Función para mostrar errores de autenticación\r\nfunction mostrarErrorAuth(error) {\r\n  let mensaje = 'Error al autenticar';\r\n  \r\n  if (error.code === 'auth/popup-closed-by-user') {\r\n    mensaje = 'El popup de autenticación fue cerrado';\r\n  } else if (error.code === 'auth/cancelled-popup-request') {\r\n    mensaje = 'Solicitud de autenticación cancelada';\r\n  } else {\r\n    mensaje = error.message || 'Error desconocido';\r\n  }\r\n  \r\n  alert(mensaje); // O puedes mostrar esto en tu UI\r\n}\r\n\r\n// Guardar datos del usuario en LocalStorage\r\nfunction guardarUsuario(user) {\r\n  localStorage.setItem('usuario', JSON.stringify({\r\n    uid: user.uid,\r\n    nombre: user.displayName,\r\n    email: user.email\r\n  }));\r\n}\r\n\r\n// Limpiar datos del usuario\r\nfunction limpiarUsuario() {\r\n  localStorage.removeItem('usuario');\r\n}\r\n\r\n// Actualizar la UI con los datos del usuario\r\nfunction actualizarUIUsuario(user) {\r\n  const btnGoogle = document.getElementById('btn-google');\r\n  if (!btnGoogle) return;\r\n\r\n  // Cambiar el botón por un simple párrafo con el nombre\r\n  btnGoogle.outerHTML = `<p class=\"usuario-nombre\"></p>`;\r\n  \r\n  // Autocompletar formulario\r\n  autocompletarFormulario(user);\r\n}\r\n\r\nfunction mostrarBotonLogin() {\r\n  const contenedor = document.querySelector('nav h1').parentElement;\r\n  if (!contenedor.querySelector('#btn-google')) {\r\n    contenedor.innerHTML += '<button id=\"btn-google\">Acceder</button>';\r\n  }\r\n}\r\n\r\nfunction autocompletarFormulario(user) {\r\n  // Solo autocompletar si estamos en el paso 4 y los campos existen\r\n  const paso4 = document.querySelector('.paso-4');\r\n  if (!paso4 || !paso4.classList.contains('activo') || !user) return;\r\n\r\n  const nombreInput = document.getElementById('nombre');\r\n  const emailInput = document.getElementById('email');\r\n  \r\n  if (nombreInput && !nombreInput.value) {\r\n    nombreInput.value = user.displayName || '';\r\n    validarNombre();\r\n  }\r\n  \r\n  if (emailInput && !emailInput.value) {\r\n    emailInput.value = user.email || '';\r\n    validarEmail();\r\n    datosReserva.email = user.email;\r\n  }\r\n}\r\n\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n////////////////////////////// \r\n"]}